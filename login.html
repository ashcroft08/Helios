<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <script>
        (function () {
            const theme = localStorage.getItem('helios-theme') || 'light';
            document.documentElement.className = theme;
        })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helios - Iniciar Sesión</title>
    <link rel="icon" type="image/svg+xml" href="img/favicon_helios.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3b82f6",
                        "primary-hover": "#2563eb",
                        success: "#10b981",
                        warning: "#f59e0b",
                        danger: "#ef4444",
                        info: "#06b6d4",
                        "background-light": "#f8fafc",
                        "background-dark": "#0a0f1a",
                        "surface-dark": "#111827",
                        "card-dark": "#1e293b",
                        "sidebar-dark": "#0f172a",
                        accent: "#8b5cf6",
                    },
                    fontFamily: { display: ["Inter", "sans-serif"] },
                    borderRadius: { DEFAULT: "0.75rem" },
                },
            },
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.15);
            }

            50% {
                box-shadow: 0 0 40px rgba(59, 130, 246, 0.3);
            }
        }

        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-card {
            animation: fade-in-up 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .login-card:hover {
            animation: pulse-glow 3s ease-in-out infinite;
        }

        .floating-logo {
            animation: float 4s ease-in-out infinite;
        }

        .bg-mesh {
            background-image:
                radial-gradient(at 20% 80%, rgba(59, 130, 246, 0.08) 0px, transparent 50%),
                radial-gradient(at 80% 20%, rgba(139, 92, 246, 0.08) 0px, transparent 50%),
                radial-gradient(at 50% 50%, rgba(16, 185, 129, 0.05) 0px, transparent 50%);
        }

        .dark .bg-mesh {
            background-image:
                radial-gradient(at 20% 80%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 80% 20%, rgba(139, 92, 246, 0.12) 0px, transparent 50%),
                radial-gradient(at 50% 50%, rgba(16, 185, 129, 0.08) 0px, transparent 50%);
        }

        .input-focus:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
        }

        .btn-login {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-login:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-1px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.4);
        }

        .btn-login:active {
            transform: translateY(0);
        }

        .btn-login:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin {
            animation: spin 0.8s linear infinite;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark min-h-screen flex items-center justify-center p-4 bg-mesh">

    <div class="login-card w-full max-w-md">
        <!-- Card -->
        <div
            class="bg-white dark:bg-card-dark rounded-3xl shadow-2xl border border-slate-200/50 dark:border-slate-700/50 overflow-hidden">

            <!-- Header with Logo -->
            <div class="pt-10 pb-6 px-8 text-center">
                <div class="floating-logo inline-block mb-6">
                    <img src="img/horizontal_helios.svg" alt="Helios" class="h-12 mx-auto dark:hidden">
                    <img src="img/horizontal_helios_oscuro.png" alt="Helios" class="h-12 mx-auto hidden dark:block">
                </div>
                <h1 class="text-2xl font-bold text-slate-800 dark:text-white">Bienvenido de vuelta</h1>
                <p class="text-slate-500 dark:text-slate-400 mt-2 text-sm">Ingresa tus credenciales para continuar</p>
            </div>

            <!-- Error Message -->
            <div id="login-error" class="hidden mx-8 mb-4 p-4 bg-danger/10 border border-danger/20 rounded-2xl">
                <div class="flex items-center gap-3">
                    <span class="material-icons-outlined text-danger text-xl">error_outline</span>
                    <p id="login-error-text" class="text-sm font-medium text-danger"></p>
                </div>
            </div>

            <!-- Form -->
            <form id="login-form" class="px-8 pb-8 space-y-5">
                <!-- Email -->
                <div>
                    <label
                        class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2 block">
                        Correo electrónico
                    </label>
                    <div class="relative">
                        <span
                            class="material-icons-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg">mail</span>
                        <input type="email" id="login-email" required autocomplete="email"
                            placeholder="correo@ejemplo.com"
                            class="input-focus w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl pl-12 pr-4 py-3.5 text-sm text-slate-800 dark:text-slate-100 placeholder:text-slate-400 outline-none transition-all">
                    </div>
                </div>

                <!-- Password -->
                <div>
                    <label
                        class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2 block">
                        Contraseña
                    </label>
                    <div class="relative">
                        <span
                            class="material-icons-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg">lock</span>
                        <input type="password" id="login-password" required autocomplete="current-password"
                            placeholder="••••••••"
                            class="input-focus w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl pl-12 pr-12 py-3.5 text-sm text-slate-800 dark:text-slate-100 placeholder:text-slate-400 outline-none transition-all">
                        <button type="button" onclick="togglePassword()"
                            class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
                            <span class="material-icons-outlined text-lg"
                                id="password-toggle-icon">visibility_off</span>
                        </button>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="btn-login"
                    class="btn-login w-full text-white py-3.5 rounded-xl font-semibold text-sm flex items-center justify-center gap-2 mt-2">
                    <span id="btn-login-icon" class="material-icons-outlined text-lg">login</span>
                    <span id="btn-login-text">Iniciar Sesión</span>
                </button>
            </form>

            <!-- Footer -->
            <div class="px-8 pb-8 pt-2 text-center">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-1 h-px bg-slate-200 dark:bg-slate-700"></div>
                    <span class="text-xs text-slate-400 font-medium">HELIOS</span>
                    <div class="flex-1 h-px bg-slate-200 dark:bg-slate-700"></div>
                </div>
                <p class="text-xs text-slate-400">
                    Sistema de Gestión y Supervisión
                </p>
            </div>
        </div>

        <!-- Theme Toggle -->
        <div class="text-center mt-6">
            <button onclick="toggleLoginTheme()"
                class="inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium text-slate-500 dark:text-slate-400 hover:bg-white/50 dark:hover:bg-slate-800/50 transition-all">
                <span class="material-icons-outlined text-lg" id="login-theme-icon">dark_mode</span>
                <span id="login-theme-text">Modo Oscuro</span>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // If already logged in, redirect to dashboard
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                window.location.href = 'index.html';
            }
        });

        // Form submission
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const btn = document.getElementById('btn-login');
            const errorDiv = document.getElementById('login-error');
            const errorText = document.getElementById('login-error-text');

            // Hide previous errors
            errorDiv.classList.add('hidden');

            // Loading state
            btn.disabled = true;
            document.getElementById('btn-login-icon').textContent = 'refresh';
            document.getElementById('btn-login-icon').classList.add('animate-spin');
            document.getElementById('btn-login-text').textContent = 'Verificando...';

            const result = await loginUser(email, password);

            if (result.success) {
                document.getElementById('btn-login-text').textContent = '¡Bienvenido!';
                document.getElementById('btn-login-icon').textContent = 'check_circle';
                document.getElementById('btn-login-icon').classList.remove('animate-spin');
                // Short delay before redirect for visual feedback
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 500);
            } else {
                // Show error
                errorText.textContent = result.message;
                errorDiv.classList.remove('hidden');

                // Reset button
                btn.disabled = false;
                document.getElementById('btn-login-icon').textContent = 'login';
                document.getElementById('btn-login-icon').classList.remove('animate-spin');
                document.getElementById('btn-login-text').textContent = 'Iniciar Sesión';
            }
        });

        // Toggle password visibility
        function togglePassword() {
            const input = document.getElementById('login-password');
            const icon = document.getElementById('password-toggle-icon');
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'visibility';
            } else {
                input.type = 'password';
                icon.textContent = 'visibility_off';
            }
        }

        // Theme toggle for login page
        function toggleLoginTheme() {
            const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.className = newTheme;
            localStorage.setItem('helios-theme', newTheme);

            document.getElementById('login-theme-icon').textContent = newTheme === 'dark' ? 'light_mode' : 'dark_mode';
            document.getElementById('login-theme-text').textContent = newTheme === 'dark' ? 'Modo Claro' : 'Modo Oscuro';
        }

        // Initialize theme icon
        (function () {
            const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            document.getElementById('login-theme-icon').textContent = theme === 'dark' ? 'light_mode' : 'dark_mode';
            document.getElementById('login-theme-text').textContent = theme === 'dark' ? 'Modo Claro' : 'Modo Oscuro';
        })();
    </script>
</body>

</html>